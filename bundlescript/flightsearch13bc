var tpfs=function(n){function t(n){var t=!0;return($("[data-ac-airport='from'][data-ac-airport-index='"+n+"']").val()===""||$("[data-ac-airport='from'][data-ac-airport-index='"+n+"']").attr("data-ac-value")==="")&&($("[data-ac-airport='from'][data-ac-airport-index='"+n+"']").notify(tpvm.messages.selectdeparture),t=!1),($("[data-ac-airport='to'][data-ac-airport-index='"+n+"']").val()===""||$("[data-ac-airport='to'][data-ac-airport-index='"+n+"']").attr("data-ac-value")==="")&&($("[data-ac-airport='to'][data-ac-airport-index='"+n+"']").notify(tpvm.messages.selectdestination),t=!1),$("[data-ac-airport='from'][data-ac-airport-index='"+n+"']").val()!==""&&$("[data-ac-airport='from'][data-ac-airport-index='"+n+"']").attr("data-ac-value")!==""&&$("[data-ac-airport='to'][data-ac-airport-index='"+n+"']").val()!==""&&$("[data-ac-airport='to'][data-ac-airport-index='"+n+"']").attr("data-ac-value")!==""&&($("[data-ac-airport='from'][data-ac-airport-index='"+n+"']").val()===$("[data-ac-airport='to'][data-ac-airport-index='"+n+"']").val()||$("[data-ac-airport='from'][data-ac-airport-index='"+n+"']").attr("data-ac-value")===$("[data-ac-airport='to'][data-ac-airport-index='"+n+"']").attr("data-ac-value"))&&($("[data-ac-airport='to'][data-ac-airport-index='"+n+"']").notify(tpvm.messages.fromtocannotsame),t=!1),t}return n.requestedSegmentCount=2,n.settings={numberOfMonths:2,daysToAdd:2,defaultDays:7,changeMonth:!1,changeYear:!1,yearRange:"-0:+20"},n.flightSearchOnLoad=function(){var t,i;$("#oneway-roundtrip .return").click(function(){tpfs.selectTrip("RT")});$("#oneway-roundtrip .roundtripclose").click(function(){tpfs.selectTrip("OW")});$("#chkDirect").click(function(){tpc.airRequestObject.AdvanceSearch.NonStop=String($(this).is(":checked"))});$('#search-form-air input[type="radio"]').change(function(){tpfs.selectTrip($(this).val())});$("#ddlAirAdult, #ddlAirChild, #ddlAirInf, #ddlClass").change(function(){var u=tpc.getLang("travellers")!=="INVALIDKEY"?tpc.getLang("travellers"):"Travellers",f=tpc.getLang("traveller")!=="INVALIDKEY"?tpc.getLang("traveller"):"Traveller",n=Number($("#ddlAirAdult").val()),t=Number($("#ddlAirChild").val()),i=Number($("#ddlAirInf").val()),r='<span class="fl">'+(n+t+i)+'<\/span><span class="fl">&nbsp;<\/span><span class="fl">'+(n+t+i>1?u:f)+'<\/span><span class="fl">&nbsp;-&nbsp;<\/span>';r+='<span class="fl">'+$("#ddlClass option:selected").text()+"<\/span>";$("#txtPax").html(r);$(".ddl-val","[data-field='#ddlAirAdult']").html(n);$(".ddl-val","[data-field='#ddlAirChild']").html(t);$(".ddl-val","[data-field='#ddlAirInf']").html(i)});$("[data-ac-airport]","#search-form-air").keydown(function(){$(this).attr("data-ac-value","")}).devbridgeAutocomplete({serviceUrl:"/static/airports",type:"GET",paramName:"q",dataType:"json",params:{lang:function(){return tpc.userSettings.cultureCode.split("-")[0]}},transformResult:function(n){return{suggestions:$.map(n.Items,function(n){return{value:n.Item.split("~")[0],data:n.Item.split("~")[1]}})}},width:400,ajaxSettings:{beforeSend:function(){}},minChars:"3",onSelect:function(n){if(n.data!=="0"){var t=Number($(this).attr("data-ac-airport-index"));$(this).attr("data-ac-airport")==="from"?$("[data-ac-airport='from'][data-ac-airport-index="+t+"]").attr("data-ac-value",n.data).val(n.value):($("[data-ac-airport='to'][data-ac-airport-index="+t+"]").attr("data-ac-value",n.data).val(n.value),$("[data-ac-airport='from'][data-ac-airport-index="+(t+1)+"]").attr("data-ac-value",n.data).val(n.value))}n.data=="0"&&($(this).attr("data-ac-airport")==="from"?$("[data-ac-airport='from']").attr("data-prev-value","").val(""):$("[data-ac-airport='to']").attr("data-prev-value","").val(""));typeof setAuosuggestAir_Company=="function"&&setAuosuggestAir_Company(this,n)}});$("input[data-ac-airport]","#search-form-air").click(function(){$(this).attr("data-prev-value",$(this).val()).val("")});$("input[data-ac-airport]","#search-form-air").blur(function(){$(this).val()==""&&$(this).val($(this).attr("data-prev-value"))});$("input[data-ac-airline]","#search-form-air").click(function(){$(this).attr("data-prev-value",$(this).val()).val("")});$("input[data-ac-airline]","#search-form-air").blur(function(){$(this).val()==""&&$($(this).attr("data-ac-hdn")).val("")});$("[data-flip-airport]","#search-form-air").click(function(){var n=$("[data-ac-airport='from'][data-ac-airport-index="+$(this).attr("data-flip-airport")+"]").val(),t=$("[data-ac-airport='from'][data-ac-airport-index="+$(this).attr("data-flip-airport")+"]").attr("data-ac-value"),i=$("[data-ac-airport='to'][data-ac-airport-index="+$(this).attr("data-flip-airport")+"]").val(),r=$("[data-ac-airport='to'][data-ac-airport-index="+$(this).attr("data-flip-airport")+"]").attr("data-ac-value");$("[data-ac-airport='from'][data-ac-airport-index="+$(this).attr("data-flip-airport")+"]").attr("data-ac-value",r).val(i);$("[data-ac-airport='to'][data-ac-airport-index="+$(this).attr("data-flip-airport")+"]").attr("data-ac-value",t).val(n);typeof setAuosuggestAir_Company=="function"&&(setAuosuggestAir_Company($("[data-ac-airport='from'][data-ac-airport-index="+$(this).attr("data-flip-airport")+"]"),""),setAuosuggestAir_Company($("[data-ac-airport='to'][data-ac-airport-index="+$(this).attr("data-flip-airport")+"]"),""))});t=$.extend({},$.datepicker.regional[tpc.companySettings.calendarLanguageCode],{numberOfMonths:n.settings.numberOfMonths===2?window.screen.availWidth<650?1:2:n.settings.numberOfMonths,dateFormat:tpc.companySettings.calendarFormat,changeMonth:n.settings.changeMonth,changeYear:n.settings.changeYear,yearRange:"-0:+20",minDate:new Date,onSelect:function(t,i){var u=!1,r;r=$("#"+i.id).attr("data-dt-to");r!=""&&(u=!0,($(r).val()==""||$("#"+i.id).datepicker("getDate")>=$(r).datepicker("getDate"))&&(d=$("#"+i.id).datepicker("getDate"),d.setDate(d.getDate()+parseInt(n.settings.daysToAdd)),$(r).datepicker("setDate",d),typeof setDayOfWeek_Company=="function"&&setDayOfWeek_Company(r)));typeof setDayOfWeek_Company=="function"&&setDayOfWeek_Company(this)},beforeShow:function(n){var r=new Date,t=new Date,u,i;if(t=t.getFullYear()+1,u=t%4||t%400?"+366D":"+365D",$(n).attr("data-dt-from")!=""){if(i=$(n).attr("data-dt-from"),$(i).val()==""){$(i).focus();throw"Error";}r=$(i).datepicker("getDate")}if(r)return{minDate:r,maxDate:u}}});$(".air-cal","#search-form-air").datepicker(t);$(".air-cal[data-dt-from]").each(function(){var t=new Date,i;$(this).attr("data-dt-from")==""?(t.setDate(t.getDate()+parseInt(n.settings.defaultDays)),$(this).datepicker("setDate",t)):(i=$(this).attr("data-dt-from"),t=$(i).datepicker("getDate"),t.setDate(t.getDate()+parseInt(n.settings.daysToAdd)),$(this).datepicker("setDate",t))});$("#btnSearchAir").click(function(){var h,t;if(tpc.airRequestObject.Passengers.Passenger.filter(function(n){return n.Type==="ADT"})[0].Count=$("#ddlAirAdult").val(),tpc.airRequestObject.Passengers.Passenger.filter(function(n){return n.Type==="CHD"})[0].Count=$("#ddlAirChild").val(),tpc.airRequestObject.Passengers.Passenger.filter(function(n){return n.Type==="INF"})[0].Count=$("#ddlAirInf").val(),tpc.airRequestObject.Flights.CabinCode=$("#ddlClass").val(),$("#nationality").length>0&&(tpc.airRequestObject.Flights.Nationality=$("#nationality").val()),h=n.validateAir(),h){var f="",i="",e="",o="",r="",s="",u="";if(tpc.airRequestObject.Flights.RequestedSegment=[],tpc.airRequestObject.Flights.TripType==="OW"||tpc.airRequestObject.Flights.TripType==="RT")u=tpc.formatDate($("#txtAirDD").datepicker("getDate")),f=$("[data-ac-airport='from'][data-ac-airport-index='1']").val(),i=$("[data-ac-airport='from'][data-ac-airport-index='1']").attr("data-ac-value"),e=i.split("#")[2],o=$("[data-ac-airport='to'][data-ac-airport-index='1']").val(),r=$("[data-ac-airport='to'][data-ac-airport-index='1']").attr("data-ac-value"),s=r.split("#")[2],tpc.airRequestObject.Flights.RequestedSegment.push(new tpc.RequestedSegment(f,o,e,s,u,"",i,r)),tpc.airRequestObject.Flights.TripType==="RT"&&(u=tpc.formatDate($("#txtAirAD").datepicker("getDate")),tpc.airRequestObject.Flights.RequestedSegment.push(new tpc.RequestedSegment(o,f,s,e,u,"",r,i)));else for(t=1;t<=n.requestedSegmentCount;t++)u=tpc.formatDate($("#txtAirDD"+t).datepicker("getDate")),f=$("[data-ac-airport='from'][data-ac-airport-index="+t+"]").val(),i=$("[data-ac-airport='from'][data-ac-airport-index="+t+"]").attr("data-ac-value"),e=i.split("#")[2],o=$("[data-ac-airport='to'][data-ac-airport-index="+t+"]").val(),r=$("[data-ac-airport='to'][data-ac-airport-index="+t+"]").attr("data-ac-value"),s=r.split("#")[2],tpc.airRequestObject.Flights.RequestedSegment.push(new tpc.RequestedSegment(f,o,e,s,u,"",i,r));tpc.hitAirSearch()}});localStorage.getItem("airrequest")!=null&&localStorage.getItem("airrequest")!=""&&(i=JSON.parse(localStorage.getItem("airrequest")),n.fillSearchAir(i));$("#ddlAirAdult").change()},n.validateAir=function(){var r;try{var i=!0,u=tpc.airRequestObject.Passengers.Passenger.reduce(function(n,t){return n+Number(t.Count)},0),f=Number(tpc.airRequestObject.Passengers.Passenger.filter(n=>n.Type==="ADT")[0].Count),e=Number(tpc.airRequestObject.Passengers.Passenger.filter(n=>n.Type==="INF")[0].Count);if($.notify.defaults({position:"top center",className:"error"}),tpc.airRequestObject.Flights.TripType==="OW"||tpc.airRequestObject.Flights.TripType==="RT")i=t(1);else for(r=1;r<=n.requestedSegmentCount;r++)i=t(r);return u>9?($("#passenger-block").notify(tpvm.messages.flighttotalpaxalert),i=!1):e>f&&($("#passenger-block").notify(tpvm.messages.flightinfadtalert),i=!1),i&&typeof tpfs.validateAirCompanyWise=="function"&&(i=tpfs.validateAirCompanyWise()),i}catch(o){return console.log(o.stack),!1}},n.fillSearchAir=function(t){var f;try{if(f=new Date,tpc.airRequestObject=t,tpc.airRequestObject.Flights.TripType==="OW"||tpc.airRequestObject.Flights.TripType==="RT"){var i=tpc.airRequestObject.Flights.RequestedSegment[0],u=i.Date.split("-"),r=new Date(u[0],Number(u[1])-1,u[2]);f.withoutTime()<=r.withoutTime()&&($("#txtAirDD").datepicker("setDate",r),r.setDate(r.getDate()+parseInt(n.settings.daysToAdd)),$("#txtAirAD").datepicker("setDate",r));$("[data-ac-airport='from'][data-ac-airport-index='1']").attr("data-ac-value",i.DepartureCountryCity).val(i.DepartureName);$("[data-ac-airport='to'][data-ac-airport-index='1']").attr("data-ac-value",i.ArrivalCountryCity).val(i.ArrivalName);$("[data-ac-airport='from'][data-ac-airport-index='2']").attr("data-ac-value",i.ArrivalCountryCity).val(i.ArrivalName);tpc.airRequestObject.Flights.TripType==="RT"&&(i=tpc.airRequestObject.Flights.RequestedSegment[1],u=i.Date.split("-"),r=new Date(u[0],Number(u[1])-1,u[2]),f.withoutTime()<=r.withoutTime()&&$("#txtAirAD").datepicker("setDate",r))}else tpc.airRequestObject.Flights.TripType==="MC"&&(n.requestedSegmentCount=tpc.airRequestObject.Flights.RequestedSegment.length,$.each(tpc.airRequestObject.Flights.RequestedSegment,function(n,t){var i=t.Date.split("-"),r=new Date(i[0],Number(i[1])-1,i[2]);f<=r&&$("#txtAirDD"+(n+1)).datepicker("setDate",r);$("[data-ac-airport='from'][data-ac-airport-index="+(n+1)+"]").attr("data-ac-value",t.DepartureCountryCity).val(t.DepartureName);$("[data-ac-airport='to'][data-ac-airport-index="+(n+1)+"]").attr("data-ac-value",t.ArrivalCountryCity).val(t.ArrivalName);$("#leg"+(n+1)).show()}),n.requestedSegmentCount>2&&$("#removemulticity").show(),n.requestedSegmentCount===5&&($("#addmulticity").hide(),$("#addFlightImg").hide()));n.selectTrip(tpc.airRequestObject.Flights.TripType);tpc.airRequestObject.AdvanceSearch.NonStop==="true"&&n.selectNonStop();tpc.airRequestObject.AdvanceSearch.NonStop===undefined&&(tpc.airRequestObject.AdvanceSearch.NonStop="false");$("#ddlAirAdult").val(tpc.airRequestObject.Passengers.Passenger.filter(function(n){return n.Type==="ADT"})[0].Count);$("#ddlAirChild").val(tpc.airRequestObject.Passengers.Passenger.filter(function(n){return n.Type==="CHD"})[0].Count);$("#ddlAirInf").val(tpc.airRequestObject.Passengers.Passenger.filter(function(n){return n.Type==="INF"})[0].Count);$("#ddlClass").val(tpc.airRequestObject.Flights.CabinCode)}catch(e){}},n.addMultiCity=function(){if(n.requestedSegmentCount<5){var t=$("[data-ac-airport='to'][data-ac-airport-index="+n.requestedSegmentCount+"]").val(),i=$("[data-ac-airport='to'][data-ac-airport-index="+n.requestedSegmentCount+"]").attr("data-ac-value");$("[data-ac-airport='from'][data-ac-airport-index="+(n.requestedSegmentCount+1)+"]").attr("data-ac-value",i).val(t);$("#leg"+(n.requestedSegmentCount+1)).show();n.requestedSegmentCount++;$("#removemulticity").show();n.requestedSegmentCount===5&&($("#addmulticity").hide(),$("#addFlightImg").hide())}return!1},n.removeMultiCity=function(){return n.requestedSegmentCount>2&&($("#leg"+n.requestedSegmentCount).hide(),$("[data-ac-airport-index="+n.requestedSegmentCount+"]").val("").attr("data-ac-value",""),n.requestedSegmentCount--,n.requestedSegmentCount===2&&$("#removemulticity").hide(),$("#addmulticity").show(),$("#addFlightImg").show()),!1},n.selectTrip=function(t){typeof n.selectTripCompanyWise=="function"&&n.selectTripCompanyWise(t);$("[name='trip'][value='"+t+"']").prop("checked",!0);tpc.airRequestObject.Flights.TripType=t;t==="OW"||t==="RT"?($("[data-tp-owrt]").show(),$("[data-tp-mc]").hide(),t==="RT"?($("#roundtrip").show(),$(".return").hide(),$(".multicity-trip").hide(),$(".multicity-depatiing").hide()):($("#roundtrip").hide(),$(".multicity-depatiing").hide(),$(".return").show())):t==="MC"&&($("[data-tp-owrt]").hide(),$("[data-tp-mc]").show())},n.selectNonStop=function(){typeof n.selectNonStopCompanyWise=="function"&&n.selectNonStopCompanyWise(tripType);$("[id='chkDirect']").prop("checked",!0);tpc.airRequestObject.AdvanceSearch.NonStop="true"},n}(tpfs||{})